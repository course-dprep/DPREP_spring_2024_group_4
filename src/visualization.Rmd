---
title: "review_score_rating"
author: "Group_4"
output: pdf_document
date: "2024-03-21"
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r, include=FALSE}
library(utils)
library(readr)
library(tidyverse)
library(dplyr)
library(data.table)
library(ggplot2)
library(knitr)
library(kableExtra)

Inside_Airbnb_Final_Dataset <- read.csv("../gen/selected_dataset.csv")

Host_Review_lm <- lm(review_scores_rating ~ host_has_profile_pic_dummy * host_identity_verified_dummy * Country_Dataset, Inside_Airbnb_Final_Dataset)
summary(Host_Review_lm)
```

# Visualization

This is an R Markdown document to show the outcome of the linear regression performed on review score ratings of AirBnb's and the effect of the presence of a profile picture of the host, whether the identity of the host is verified and if there is a difference in the rating between Greece and France.

We start with showing the results of the linear regression by providing a data table which show all the effects. It shows the coefficients, standard error, p-value and a clarification whether there is a significant effect of the variable or not. The datatable includes the solo effects as well as the interaction effects. 

```{r}
# Extract coefficients, standard errors, p-values, and significance levels
coefficients <- coef(Host_Review_lm)
standard_errors <- summary(Host_Review_lm)$coefficients[, "Std. Error"]
p_values <- summary(Host_Review_lm)$coefficients[, "Pr(>|t|)"]
significance <- ifelse(p_values < 0.05, "significant", "not significant")

# Creating a data table
datatable <- data.table(
  Effect = c("Intercept", "Profile picture", "Identity verification", "Country",
             "Profile picture x Identity verification", "Profile picture x Country",
             "Identity verification x Country", "Profile picture x Identity verification x Country"),
  Coefficients = coefficients,
  Standard_Error = standard_errors,
  P_Value = p_values,
  Significance = significance
)

```

The datatable shows that, except for identity verification, all the variables and interactions have a significant effect on the review score rating of an AirBnb.


For some more insight in the effect we wanted to show the mean difference in review score rating between the countries and each of the variables profile picture and identity. Here you can see what on average is the difference between Greece and France

```{r}
# Calculate the mean review scores rating
average_ratings_profilepic <- tapply(Inside_Airbnb_Final_Dataset$review_scores_rating, list(Inside_Airbnb_Final_Dataset$Country_Dataset, Inside_Airbnb_Final_Dataset$host_has_profile_pic_dummy), mean, na.rm = TRUE)
average_ratings_identity <- tapply(Inside_Airbnb_Final_Dataset$review_scores_rating, list(Inside_Airbnb_Final_Dataset$Country_Dataset, Inside_Airbnb_Final_Dataset$host_identity_verified_dummy), mean, na.rm = TRUE)

# Table with average ratings on the variables
print(average_ratings_profilepic)
print(average_ratings_identity)

```

The mean differences can be presented in a barplot for each variable. 
For the variable profile picture the following barplot exceeded from the regression.

```{r}
# Barplot for the effect of the presence of a profile picture of the host and the country on review score ratings
barplot(
  height = average_ratings_profilepic,
  beside = TRUE,
  col = c("lightblue", "lightgreen"),
  ylim = c(0, 5),
  xlab = "Country - Profile Picture Available",
  ylab = "Average Review Score Rating",
)
legend("right", legend = rownames(average_ratings_profilepic), fill = c("lightblue", "lightgreen"))

```

For identity of the host the barplot looks as follows.

```{r}
# Barplot for the effect of the identity verification of the host and the country on the review score ratings
barplot(
  height = average_ratings_identity,
  beside = TRUE,
  col = c("lightblue", "lightgreen"),
  ylim = c(0, 5),  
  xlab = "Country - Identity Verified",
  ylab = "Average Review Score Rating",
)
legend("right", legend = rownames(average_ratings_identity), fill = c("lightblue", "lightgreen"))
```

The results of the linear regression on review score rating can also be shown in an interaction plot that shows the distribution.

```{r}
# Interaction Plot for all pairs of independent variables
ggplot(Inside_Airbnb_Final_Dataset, aes(x = host_has_profile_pic_dummy, y = review_scores_rating, color = host_identity_verified_dummy)) +
  geom_point() +
  geom_smooth(method = "lm", se = FALSE) +
  labs(x = "Host Has Profile Pic", y = "Review Scores Rating", color = "Host Identity Verified") +
  facet_wrap(~ Country_Dataset)
```

The coefficients also show the effect. It displays how strong the variable has an effect and shows in which direction. To make this even more clear we created a coefficient plot.

```{r}
# Coefficients Plot
# Excluding the intercept coefficient
coef_data <- data.frame(coef = coef(Host_Review_lm)[-1], variable = names(coef(Host_Review_lm))[-1])

ggplot(coef_data, aes(x = as.factor(1:7), y = coef)) +
  geom_bar(stat = "identity") +
  labs(x = "Variable", y = "Coefficient")
```
